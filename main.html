<!DOCTYPE html>
<html>
<head>
	<title>五子棋</title>
</head>
<script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script type="text/javascript">
	//全局变量
	var turn=0; //轮到黑棋:0/白棋:1

	var chessboard = [
	[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
	[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
	[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
	[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
	[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
	[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
	[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
	[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
	[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
	[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
	[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
	[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
	[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
	[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
	[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]
	];
/*
	var chessboard = [
[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
[-1,-1,-1,-1,-1,-1,-1,-1,-1,1,1,-1,-1,-1,-1],
[-1,-1,-1,-1,-1,-1,-1,-1,0,-1,0,1,-1,-1,-1],
[-1,-1,-1,-1,-1,-1,-1,0,1,-1,0,-1,-1,-1,-1],
[-1,-1,-1,-1,-1,1,0,0,1,0,-1,-1,-1,-1,-1],
[-1,-1,-1,-1,-1,0,1,1,0,1,0,-1,-1,-1,-1],
[-1,-1,-1,-1,1,0,-1,0,0,1,1,-1,-1,-1,-1],
[-1,-1,-1,-1,-1,0,1,1,1,0,-1,-1,-1,-1,-1],
[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],
[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]

	];
*/
	var debug=false;
	var boardsize=15
	var loading=false
	var depth=4
	var maxdepth=12;
	var cpucolor=1;
	var flag=true
	var historys = [];
	var acounttemp=0;
	var tacountt=0;
	var chessupdate=true;
	var started=false;
	var finished=false;

</script>
<script type="text/javascript" src="js/support.js"></script>
<script type="text/javascript">
	var mainz = new Zobrist();
	var ematch = new Array();
	function dodraw()
	{
		if(chessupdate)
		{
			for(var i=0;i<boardsize;i++)
				for(var k = 0; k < boardsize; k++)
					if(chessboard[i][k]>=0)
					{
						drawchess(k,i,chessboard[i][k])
					}
			chessupdate=false;
		}
	}
	var drawchesses = setInterval("dodraw()",200);
</script>
<script type="text/javascript" src="js/evaluate.js"></script>
<script type="text/javascript" src="js/calculate.js"></script>
<script type="text/javascript" src="js/kill.js"></script>
<script type="text/javascript">
	window.onload=function(){

	/*初始化*/
		//显示大小
		var background=document.getElementById("background")
		var doback = document.getElementById("back")
		var doexport = document.getElementById("export")
		var youfirst = document.getElementById("youfirst")

		youfirst.onclick = function(e)
		{
			if(started)
				return;
			cpucolor=0;
			dochess(7,7,0);
			turn=1;
		}

		doback.onclick = function(e)
		{
			var ev = e || window.event;
			var cxt=document.getElementById("background").getContext("2d");
			var len = historys.length;
			if (len<2)
				return
			var point1 = historys.pop()
			chessboard[point1[0]][point1[1]]=-1;
			mainz.cal(point1[0],point1[1],cpucolor);
			cxt.clearRect(point1[1]*35+10,point1[0]*35+10,25,25)

			point1 = historys.pop()
			chessboard[point1[0]][point1[1]]=-1;
			mainz.cal(point1[0],point1[1],1-cpucolor);
			cxt.clearRect(point1[1]*35+10,point1[0]*35+10,25,25)

			finished=false;
		}

		doexport.onclick = function(e)
		{
			var str="";
			for(var i=0;i<15;i++)
			{
				str+="["+chessboard[i].toString()+"],\n"
			}
			console.log(str);
		}


		background.style.left=parseInt((document.body.clientWidth-background.width)/2).toString()+"px";
		background.oncontextmenu = function(e){
            e.preventDefault();
        };
        background.onmouseup = function(e)
        {
        	var ev = e || window.event;
        	if(ev.button!=2)
        		return
        	var x = ev.offsetX-22
			var y = ev.offsetY-22
			var tx = parseInt(x/35+0.5)
			var ty = parseInt(y/35+0.5)
			console.log(ty,tx)
        }
	/*键盘点击操作*/
		background.onclick=function(e){

			if(loading||finished)
				return;
			else
				loading=true
			var ev = e || window.event;
			var x = ev.offsetX-22
			var y = ev.offsetY-22
			var tx = parseInt(x/35+0.5)
			var ty = parseInt(y/35+0.5)
			if(chessboard[ty][tx]!=-1)
			{
				loading=false;
				return;
			}
			/*
			var dev=10    //允许误差像素值
			console.log("clicked？", Math.abs(x-tx*35)>dev, Math.abs(y-ty*35)>dev, chessboard[ty][tx]!=-1);
			if (Math.abs(x-tx*35)>dev || Math.abs(y-ty*35)>dev || chessboard[ty][tx]!=-1){
				return;
			}
			*/
			console.log("clicked!");
			if(historys.length<4)
				depth=2;
			else
				depth=4
			dochess(tx,ty,turn)
			turn=1-turn;
			target = calnext(chessboard,turn)
			console.log(target)
			dochess(target[1],target[0],turn)
			turn=1-turn
			loading=false
		}
	}

	window.onresize=function(){
		var background=document.getElementById("background")
		background.style.left=parseInt((document.body.clientWidth-background.width)/2).toString()+"px";
	}
</script>
<style type="text/css">
	#background{
		position : fixed;
		z-index : 1;
		left: 50%;
		top: 20%;
		background-image: url("img/board.jpg");
		background-repeat:no-repeat;
		background-size:100%,100%;
	}
</style>
<body>
<button id="back">悔棋</button>
<button id="export">导出</button>
<button id="youfirst">电脑先手</button>
<canvas id="background" width="535" height="535"></canvas>
</body>
</html>